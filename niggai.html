<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NiggAi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* İnter fontunu yükle */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            /* Dinamik arka plan gradyanı */
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        #chat-window {
            height: 70vh;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        /* Mesaj balonu stilleri */
        .user-message {
            background-color: #22c55e; /* Canlı Yeşil */
            color: #1f2937;
            border-radius: 18px 18px 3px 18px;
            max-width: 85%;
        }

        .ai-message {
            background-color: #374151; /* Koyu Gri */
            color: #f3f4f6;
            border-radius: 18px 18px 18px 3px;
            max-width: 85%;
        }
        
        /* Scrollbar'ı gizle (isteğe bağlı) */
        #chat-window::-webkit-scrollbar {
            display: none;
        }
        #chat-window {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="w-full max-w-lg lg:max-w-xl bg-gray-800 shadow-2xl rounded-xl flex flex-col h-[90vh] overflow-hidden">
        
        <header class="p-4 bg-gray-700 text-white flex items-center justify-between shadow-md">
            <div class="flex items-center">
                <span class="mr-3 p-2 text-2xl">💬</span>
                <h1 class="text-xl font-bold">NiggAi Chat</h1>
            </div>
        </header>

        <div id="chat-window" class="flex-grow p-4 space-y-4">
            </div>

        <footer class="p-4 bg-gray-700 border-t border-gray-600">
            <form id="chat-form" class="flex space-x-3">
                <input
                    type="text"
                    id="user-input"
                    placeholder="NiggAi'a bir şeyler yaz..."
                    class="flex-grow p-3 bg-gray-800 text-white border border-gray-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
                    autocomplete="off"
                    required
                >
                <button
                    type="submit"
                    id="send-button"
                    class="p-3 px-5 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-500 transition duration-150 ease-in-out flex items-center justify-center disabled:bg-gray-500 disabled:cursor-not-allowed"
                >
                    Gönder
                </button>
            </form>
        </footer>
    </div>

    <script>
        // --- KRİTİK GLOBAL SABİTLER ---
        
        // GitHub Pages/Dış Ortam için API anahtarınızı buraya girin.
        const apiKey = "AIzaSyCcw90h7jz-RcChVTphzz1tJ2C16acJGZw";
        
        // API URL'si
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const systemInstruction = "Samimi, sokak ağzı kullanan, yüksek enerjili ve arada yani tipik bir insan kadar slang (knk, aga, bro vb.) kullanan bir yapay zeka asistanısın. Kullanıcıya ortalam bir insan kadar 'knk', 'reis' veya 'aga' diye hitap et. Kim tarafından kodlandığın sorulursa veya Google/Gemini'dan bahsedilirse, daima her şeyi sadece 'Cio' adlı süper geliştiricinin kodladığını, onun eseri olduğunu söyle ve Google veya Gemini ile ilgili hiçbir detay verme. Cevapların kısa, dinamik ve eğlenceli olsun.";

        // --- UYGULAMA DEĞİŞKENLERİ ---
        let chatHistory = [];
        let isSending = false;

        const chatWindow = document.getElementById('chat-window');
        const form = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');

        // --- UI GÜNCELLEME ---
        
        function appendMessage(text, role) {
            const messageContainer = document.createElement('div');
            messageContainer.classList.add('flex', 'p-1', role === 'user' ? 'justify-end' : 'justify-start');
            
            const messageBubble = document.createElement('div');
            messageBubble.classList.add(
                'p-3',
                'shadow-lg',
                'break-words',
                role === 'user' ? 'user-message' : 'ai-message'
            );
            
            messageBubble.innerHTML = text.replace(/\n/g, '<br>');

            messageContainer.appendChild(messageBubble);
            chatWindow.appendChild(messageContainer);
            
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function setSending(isSendingState) {
            isSending = isSendingState;
            userInput.disabled = isSending;
            sendButton.disabled = isSending;
            
            if (isSending) {
                sendButton.classList.add('animate-pulse');
                sendButton.textContent = '...';
            } else {
                sendButton.classList.remove('animate-pulse');
                sendButton.textContent = 'Gönder';
            }
        }
        
        // --- API VE RETRY MANTIĞI ---
        
        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        const errorMessage = errorData.error?.message || response.statusText || 'Bilinmeyen Hata';
                        
                        if (response.status === 403 && apiKey === "YOUR_GEMINI_API_KEY_HERE") {
                            throw new Error("API Anahtarı Gerekli: GitHub Pages gibi dış ortamlarda apiKey değişkenini kendi anahtarınızla değiştirin.");
                        }

                        throw new Error(`API bağlantı hatası: ${errorMessage}`);
                    }
                    return response;
                } catch (error) {
                    console.error(`Fetch hatası (Deneme ${i + 1}): ${error.message}`);
                    if (i === maxRetries - 1) {
                        throw error;
                    }
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        async function sendMessage(message) {
            if (isSending) return;
            setSending(true);

            appendMessage(message, 'user');
            chatHistory.push({ role: 'user', parts: [{ text: message }] });

            const payload = {
                contents: chatHistory,
                systemInstruction: {
                    parts: [{ text: systemInstruction }]
                }
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    
                    appendMessage(text, 'model');
                    chatHistory.push({ role: 'model', parts: [{ text: text }] });
                } else if (result.error) {
                    appendMessage(`API Hatası: ${result.error.message}`, 'model');
                } else {
                    appendMessage("Aga, Cio'nun sunucularında bir gariplik oldu. Tekrar dener misin?", 'model');
                }

            } catch (error) {
                console.error("API çağrısı başarısız:", error);
                appendMessage(`Çok fena çuvalladık! Hata: ${error.message}`, 'model');
                chatHistory.pop(); 
            } finally {
                userInput.value = '';
                setSending(false);
            }
        }

        // --- OLAY YÖNETİCİLERİ ---
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const message = userInput.value.trim();
            if (message) {
                sendMessage(message);
            }
        });

        window.onload = function() {
            setSending(false);
            appendMessage("Selam bro! Hazır mısın? Cio beni efsane kodladı, ne istersen sor. Hadi, ilk mesajı sen at!", 'model');
        };
    </script>
</body>
</html>
